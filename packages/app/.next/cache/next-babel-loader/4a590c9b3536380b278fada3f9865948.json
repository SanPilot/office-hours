{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { API } from \"@koh/api-client\";\nimport { Question } from \"@koh/common\";\nimport useSWR from \"swr\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport { useEventSource } from \"./useEventSource\";\nexport function useQuestions(qid) {\n  var _useSWR = useSWR(qid && \"/api/v1/queues/\".concat(qid, \"/questions\"), /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.questions.index(Number(qid)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      questions = _useSWR.data,\n      questionsError = _useSWR.error,\n      mutateQuestions = _useSWR.mutate; // Subscribe to sse\n\n\n  useEventSource(qid && \"/api/v1/queues/\".concat(qid, \"/sse\"), \"question\", useCallback(function (data) {\n    if (data.questions) {\n      mutateQuestions(plainToClass(Question, data.questions), false);\n    }\n  }, [mutateQuestions]));\n  var mutateQuestion = useCallback(function (newQuestion) {\n    var newQuestions = questions === null || questions === void 0 ? void 0 : questions.map(function (q) {\n      return q.id === newQuestion.id ? newQuestion : q;\n    });\n    mutateQuestions(newQuestions);\n  }, [questions, mutateQuestions]);\n  return {\n    questions: questions,\n    questionsError: questionsError,\n    mutateQuestions: mutateQuestions,\n    mutateQuestion: mutateQuestion\n  };\n}","map":{"version":3,"sources":["/home/runner/work/office-hours/office-hours/packages/app/hooks/useQuestions.ts"],"names":["API","Question","useSWR","plainToClass","useCallback","useEventSource","useQuestions","qid","questions","index","Number","data","questionsError","error","mutateQuestions","mutate","mutateQuestion","newQuestion","newQuestions","map","q","id"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,iBAApB;AACA,SAEEC,QAFF,QAIO,aAJP;AAKA,OAAOC,MAAP,MAA0C,KAA1C;AACA,SAASC,YAAT,QAA6B,mBAA7B;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAYA,OAAO,SAASC,YAAT,CAAsBC,GAAtB,EAAsD;AAAA,gBAKvDL,MAAM,CAACK,GAAG,6BAAsBA,GAAtB,eAAJ,wEAA2C;AAAA;AAAA;AAAA;AAAA;AAAA,6CACnDP,GAAG,CAACQ,SAAJ,CAAcC,KAAd,CAAoBC,MAAM,CAACH,GAAD,CAA1B,CADmD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA3C,GALiD;AAAA,MAEnDC,SAFmD,WAEzDG,IAFyD;AAAA,MAGlDC,cAHkD,WAGzDC,KAHyD;AAAA,MAIjDC,eAJiD,WAIzDC,MAJyD,EAS3D;;;AACAV,EAAAA,cAAc,CACZE,GAAG,6BAAsBA,GAAtB,SADS,EAEZ,UAFY,EAGZH,WAAW,CACT,UAACO,IAAD,EAA4B;AAC1B,QAAIA,IAAI,CAACH,SAAT,EAAoB;AAClBM,MAAAA,eAAe,CAACX,YAAY,CAACF,QAAD,EAAWU,IAAI,CAACH,SAAhB,CAAb,EAAyC,KAAzC,CAAf;AACD;AACF,GALQ,EAMT,CAACM,eAAD,CANS,CAHC,CAAd;AAaA,MAAME,cAAc,GAAGZ,WAAW,CAChC,UAACa,WAAD,EAAiB;AACf,QAAMC,YAAY,GAAGV,SAAH,aAAGA,SAAH,uBAAGA,SAAS,CAAEW,GAAX,CAAe,UAACC,CAAD;AAAA,aAClCA,CAAC,CAACC,EAAF,KAASJ,WAAW,CAACI,EAArB,GAA0BJ,WAA1B,GAAwCG,CADN;AAAA,KAAf,CAArB;AAGAN,IAAAA,eAAe,CAACI,YAAD,CAAf;AACD,GAN+B,EAOhC,CAACV,SAAD,EAAYM,eAAZ,CAPgC,CAAlC;AAUA,SAAO;AAAEN,IAAAA,SAAS,EAATA,SAAF;AAAaI,IAAAA,cAAc,EAAdA,cAAb;AAA6BE,IAAAA,eAAe,EAAfA,eAA7B;AAA8CE,IAAAA,cAAc,EAAdA;AAA9C,GAAP;AACD","sourcesContent":["import { API } from \"@koh/api-client\";\nimport {\n  ListQuestionsResponse,\n  Question,\n  SSEQueueResponse,\n} from \"@koh/common\";\nimport useSWR, { responseInterface } from \"swr\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport { useEventSource } from \"./useEventSource\";\n\ntype questionsResponse = responseInterface<ListQuestionsResponse, any>;\n\ninterface UseQuestionReturn {\n  questions?: questionsResponse[\"data\"];\n  questionsError: questionsResponse[\"error\"];\n  mutateQuestions: questionsResponse[\"mutate\"];\n  // Mutate a specific question\n  mutateQuestion: (newQuestion: Question) => void;\n}\n\nexport function useQuestions(qid: number): UseQuestionReturn {\n  const {\n    data: questions,\n    error: questionsError,\n    mutate: mutateQuestions,\n  } = useSWR(qid && `/api/v1/queues/${qid}/questions`, async () =>\n    API.questions.index(Number(qid))\n  );\n\n  // Subscribe to sse\n  useEventSource(\n    qid && `/api/v1/queues/${qid}/sse`,\n    \"question\",\n    useCallback(\n      (data: SSEQueueResponse) => {\n        if (data.questions) {\n          mutateQuestions(plainToClass(Question, data.questions), false);\n        }\n      },\n      [mutateQuestions]\n    )\n  );\n\n  const mutateQuestion = useCallback(\n    (newQuestion) => {\n      const newQuestions = questions?.map((q) =>\n        q.id === newQuestion.id ? newQuestion : q\n      );\n      mutateQuestions(newQuestions);\n    },\n    [questions, mutateQuestions]\n  );\n\n  return { questions, questionsError, mutateQuestions, mutateQuestion };\n}\n"]},"metadata":{},"sourceType":"module"}